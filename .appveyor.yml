image:
  - Ubuntu1804
  - Visual Studio 2017

shallow_clone: true

init:
  - cmake --version

install:
  - mkdir third_party
  - cd third_party

  - git clone --depth=1 https://github.com/nothings/stb
  - git clone -b v1.3.3 --depth=1 https://github.com/foonathan/debug_assert
  - git clone -b release-1.8.1 --depth=1 https://github.com/abseil/googletest

  - cd ..

  - git clone --depth=1 https://github.com/bggd/test_data

  - cmd: vcpkg install openal-soft:x64-windows
  - cmd: copy C:\tools\vcpkg\installed\x64-windows\bin\OpenAL32.dll test_data

  - sh: sudo apt-get install -y libopenal-dev

build_script:
  - mkdir build
  - cd build

  - cmd: set OPENALDIR=C:\tools\vcpkg\installed\x64-windows
  - cmd: cmake -G "Visual Studio 15 2017 Win64" ..

  - sh: cmake ..

  - cmake --build . --config Debug

test_script:
  - cmd: cd ..
  - cmd: cd test_data

  - cmd: set ALSOFT_DRIVERS=null
  - sh: export ALSOFT_DRIVERS=null

  - cmd: ..\build\Debug\test_libminigame.exe

  - sh: ctest -C Debug
  - sh: ls -R ../build
